<html>

<head></head>

<body>
    <script>
        var userInfo = null;
        var authToken = getQueryToken() || getStoredToken();
        if(authToken){
            localStorage.setItem('phonecasetoken', authToken);

            $.ajax({
                method: 'GET',
                url: "https://phonecase.auth.ap-northeast-2.amazoncognito.com/oauth2/userInfo",
                headers: {
                    "Accept": "*/*",
                    Authorization: 'Bearer ' + authToken
                },
                success: function (result) {
                    userInfo = result;
                    alert(JSON.stringify(userInfo));
                },
                error: function ajaxError(jqXHR, textStatus, errorThrown) {

                }
            });
        }

        //url 해쉬 토큰 조회
        function getQueryToken(){
            var hash = new URLSearchParams(window.location.hash);
            return hash.get('access_token');
        }
        
        //저장된 토큰 조회
        function getStoredToken(){
            return localStorage.getItem('phonecasetoken');
        }

        function callApi() {
            if(!authToken){
                return;
            }

            $.ajax({
                method: 'POST',
                url: "https://aaav0dws6a.execute-api.ap-northeast-2.amazonaws.com/beta/getlistprod",
                headers: {
                    "Accept": "*/*",
                    Authorization: 'Bearer ' + authToken
                },
                data: JSON.stringify({
                    "Category1": "케이스",
                    "Category2": "다이어리",
                    "Maker": "삼성",
                    "Model": "SM-A805F",
                    "Name": "모란카노 카노 다이어리",
                    "Phone": "갤럭시A80",
                    "Price": {
                        "start": 0,
                        "end": 99990
                    },
                    "Keyword": "갤럭"
                }),
                contentType: 'application/json',
                success: function (result) {
                    alert(JSON.stringify(reuslt));
                },
                error: function ajaxError(jqXHR, textStatus, errorThrown) {

                }
            });
        }
    </script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="amazon-cognito-identity.min.js"></script>
    <script src="aws-sdk.min.js"></script>
    <div>
        <a href="https://phonecase.auth.ap-northeast-2.amazoncognito.com/login?response_type=token&client_id=gi18c058r50gup2clds7dk93q&redirect_uri=https://kanginhan.github.io/samplePage">로그인</a>
    </div>
    <button onclick="callApi()">api호출</button>
    
    <fb:login-button scope="public_profile,email" onlogin="checkLoginState();"></fb:login-button>
</body>

</html>
